/**
 * Test Payment Data Seeder
 * 
 * Creates test data for payment gateway UI testing:
 * - Test customers with various profiles
 * - Test orders in different states
 * - Test payments (SUCCEEDED, PENDING, FAILED, REFUNDED, PARTIALLY_REFUNDED)
 * - Test refunds
 * - Test webhook logs
 * 
 * Usage:
 *   tsx scripts/seed-test-payments.ts
 * 
 * NOTE: This is a legacy file. The Payment, Order, Customer, Refund, and WebhookLog
 * models do not exist in the current Prisma schema. This file cannot be executed.
 * @ts-nocheck
 */

import { PrismaClient, PaymentProvider, PaymentStatus, RefundStatus, RefundReason, OrderStatus } from '@prisma/client';
import { Decimal } from '@prisma/client/runtime/library';

const prisma = new PrismaClient();

async function main() {
  console.log('ðŸŒ± Starting payment test data seeding...\n');

  // ========================================
  // 1. Create Test Customers
  // ========================================
  console.log('ðŸ‘¥ Creating test customers...');
  
  const customer1 = await prisma.customer.create({
    data: {
      email: 'john.doe@example.com',
      firstName: 'John',
      lastName: 'Doe',
      phone: '+1-555-0101',
      company: 'Acme Corporation',
      address: {
        street: '123 Main St',
        city: 'New York',
        state: 'NY',
        zip: '10001',
        country: 'USA'
      }
    }
  });

  const customer2 = await prisma.customer.create({
    data: {
      email: 'jane.smith@example.com',
      firstName: 'Jane',
      lastName: 'Smith',
      phone: '+1-555-0102',
      company: 'TechCorp Inc',
      address: {
        street: '456 Oak Ave',
        city: 'San Francisco',
        state: 'CA',
        zip: '94102',
        country: 'USA'
      }
    }
  });

  const customer3 = await prisma.customer.create({
    data: {
      email: 'bob.wilson@example.com',
      firstName: 'Bob',
      lastName: 'Wilson',
      phone: '+1-555-0103',
      address: {
        street: '789 Pine Rd',
        city: 'Austin',
        state: 'TX',
        zip: '78701',
        country: 'USA'
      }
    }
  });

  console.log(`âœ… Created 3 test customers\n`);

  // ========================================
  // 2. Create Test Orders
  // ========================================
  console.log('ðŸ“¦ Creating test orders...');

  // Get some existing products (assuming products exist from Phase 3)
  let products = await prisma.part.findMany({ take: 5 });
  
  if (products.length === 0) {
    console.log('âš ï¸  No products found. Creating sample data...');
    
    // Create a sample category first
    const category = await prisma.category.create({
      data: {
        name: 'Test Category',
        slug: 'test-category',
        description: 'Test category for payment testing'
      }
    });

    // Create sample product
    const sampleProduct = await prisma.part.create({
      data: {
        name: 'Sample Engine Part',
        slug: 'sample-engine-part-test',
        partNumber: 'TEST-001',
        description: 'Test product for payment testing',
        price: new Decimal(99.99),
        stockQuantity: 100,
        categoryId: category.id,
        images: ['https://placehold.co/400x300/png?text=Test+Product']
      }
    });
    products = [sampleProduct];
  }

  const order1 = await prisma.order.create({
    data: {
      orderNumber: 'ORD-TEST-001',
      customerId: customer1.id,
      status: OrderStatus.PAID,
      totalAmount: new Decimal(299.99),
      shippingCost: new Decimal(15.00),
      notes: 'Test order - successful payment',
      shippingAddress: {
        street: '123 Main St',
        city: 'New York',
        state: 'NY',
        zip: '10001',
        country: 'USA'
      },
      billingAddress: {
        street: '123 Main St',
        city: 'New York',
        state: 'NY',
        zip: '10001',
        country: 'USA'
      },
      paidAt: new Date('2025-10-10T14:30:00Z'),
      orderItems: {
        create: [
          {
            partId: products[0].id,
            quantity: 2,
            price: new Decimal(99.99)
          },
          {
            partId: products[1] ? products[1].id : products[0].id,
            quantity: 1,
            price: new Decimal(100.00)
          }
        ]
      }
    }
  });

  const order2 = await prisma.order.create({
    data: {
      orderNumber: 'ORD-TEST-002',
      customerId: customer2.id,
      status: OrderStatus.PENDING,
      totalAmount: new Decimal(149.99),
      shippingCost: new Decimal(10.00),
      notes: 'Test order - pending payment',
      shippingAddress: {
        street: '456 Oak Ave',
        city: 'San Francisco',
        state: 'CA',
        zip: '94102',
        country: 'USA'
      },
      orderItems: {
        create: [
          {
            partId: products[0].id,
            quantity: 1,
            price: new Decimal(139.99)
          }
        ]
      }
    }
  });

  const order3 = await prisma.order.create({
    data: {
      orderNumber: 'ORD-TEST-003',
      customerId: customer3.id,
      status: OrderStatus.PAYMENT_FAILED,
      totalAmount: new Decimal(599.99),
      shippingCost: new Decimal(25.00),
      notes: 'Test order - payment failed',
      shippingAddress: {
        street: '789 Pine Rd',
        city: 'Austin',
        state: 'TX',
        zip: '78701',
        country: 'USA'
      },
      orderItems: {
        create: [
          {
            partId: products[0].id,
            quantity: 5,
            price: new Decimal(119.99)
          }
        ]
      }
    }
  });

  const order4 = await prisma.order.create({
    data: {
      orderNumber: 'ORD-TEST-004',
      customerId: customer1.id,
      status: OrderStatus.REFUNDED,
      totalAmount: new Decimal(199.99),
      shippingCost: new Decimal(12.00),
      notes: 'Test order - fully refunded',
      shippingAddress: {
        street: '123 Main St',
        city: 'New York',
        state: 'NY',
        zip: '10001',
        country: 'USA'
      },
      paidAt: new Date('2025-10-08T10:15:00Z'),
      orderItems: {
        create: [
          {
            partId: products[0].id,
            quantity: 2,
            price: new Decimal(99.99)
          }
        ]
      }
    }
  });

  const order5 = await prisma.order.create({
    data: {
      orderNumber: 'ORD-TEST-005',
      customerId: customer2.id,
      status: OrderStatus.PAID,
      totalAmount: new Decimal(449.99),
      shippingCost: new Decimal(20.00),
      notes: 'Test order - partially refunded',
      shippingAddress: {
        street: '456 Oak Ave',
        city: 'San Francisco',
        state: 'CA',
        zip: '94102',
        country: 'USA'
      },
      paidAt: new Date('2025-10-09T16:45:00Z'),
      orderItems: {
        create: [
          {
            partId: products[0].id,
            quantity: 3,
            price: new Decimal(149.99)
          }
        ]
      }
    }
  });

  console.log(`âœ… Created 5 test orders\n`);

  // ========================================
  // 3. Create Test Payments
  // ========================================
  console.log('ðŸ’³ Creating test payments...');

  // Payment 1: Successful payment
  const payment1 = await prisma.payment.create({
    data: {
      orderId: order1.id,
      customerId: customer1.id,
      provider: PaymentProvider.STRIPE,
      transactionId: 'pi_test_1_success',
      clientSecret: 'pi_test_1_success_secret_123',
      amount: new Decimal(314.99),
      currency: 'USD',
      status: PaymentStatus.SUCCEEDED,
      paidAt: new Date('2025-10-10T14:30:00Z'),
      idempotencyKey: 'idem_test_1',
      metadata: {
        paymentMethod: 'card',
        last4: '4242',
        brand: 'visa',
        stripeCustomerId: 'cus_test_123'
      }
    }
  });

  // Payment 2: Pending payment
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const _payment2 = await prisma.payment.create({
    data: {
      orderId: order2.id,
      customerId: customer2.id,
      provider: PaymentProvider.STRIPE,
      transactionId: 'pi_test_2_pending',
      clientSecret: 'pi_test_2_pending_secret_456',
      amount: new Decimal(159.99),
      currency: 'USD',
      status: PaymentStatus.PENDING,
      idempotencyKey: 'idem_test_2',
      metadata: {
        paymentMethod: 'card',
        last4: '5555',
        brand: 'mastercard'
      }
    }
  });

  // Payment 3: Failed payment
  const payment3 = await prisma.payment.create({
    data: {
      orderId: order3.id,
      customerId: customer3.id,
      provider: PaymentProvider.STRIPE,
      transactionId: 'pi_test_3_failed',
      clientSecret: 'pi_test_3_failed_secret_789',
      amount: new Decimal(624.99),
      currency: 'USD',
      status: PaymentStatus.FAILED,
      failedAt: new Date('2025-10-11T09:20:00Z'),
      errorMessage: 'Your card was declined. Please try another payment method.',
      idempotencyKey: 'idem_test_3',
      metadata: {
        paymentMethod: 'card',
        last4: '0002',
        brand: 'visa',
        declineCode: 'generic_decline'
      }
    }
  });

  // Payment 4: Fully refunded payment
  const payment4 = await prisma.payment.create({
    data: {
      orderId: order4.id,
      customerId: customer1.id,
      provider: PaymentProvider.STRIPE,
      transactionId: 'pi_test_4_refunded',
      clientSecret: 'pi_test_4_refunded_secret_101',
      amount: new Decimal(211.99),
      currency: 'USD',
      status: PaymentStatus.REFUNDED,
      paidAt: new Date('2025-10-08T10:15:00Z'),
      refundedAmount: new Decimal(211.99),
      idempotencyKey: 'idem_test_4',
      metadata: {
        paymentMethod: 'card',
        last4: '4242',
        brand: 'visa'
      }
    }
  });

  // Payment 5: Partially refunded payment
  const payment5 = await prisma.payment.create({
    data: {
      orderId: order5.id,
      customerId: customer2.id,
      provider: PaymentProvider.STRIPE,
      transactionId: 'pi_test_5_partial_refund',
      clientSecret: 'pi_test_5_partial_refund_secret_202',
      amount: new Decimal(469.99),
      currency: 'USD',
      status: PaymentStatus.PARTIALLY_REFUNDED,
      paidAt: new Date('2025-10-09T16:45:00Z'),
      refundedAmount: new Decimal(149.99),
      idempotencyKey: 'idem_test_5',
      metadata: {
        paymentMethod: 'card',
        last4: '5555',
        brand: 'mastercard'
      }
    }
  });

  // Payment 6: Another successful payment (for variety)
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const _payment6 = await prisma.payment.create({
    data: {
      orderId: order1.id,
      customerId: customer1.id,
      provider: PaymentProvider.PAYPAL,
      transactionId: 'pp_test_6_success',
      amount: new Decimal(99.99),
      currency: 'USD',
      status: PaymentStatus.SUCCEEDED,
      paidAt: new Date('2025-10-11T11:00:00Z'),
      idempotencyKey: 'idem_test_6',
      metadata: {
        paymentMethod: 'paypal',
        paypalEmail: 'john.doe@example.com',
        paypalTransactionId: 'PP123456789'
      }
    }
  });

  console.log(`âœ… Created 6 test payments\n`);

  // ========================================
  // 4. Create Test Refunds
  // ========================================
  console.log('â†©ï¸  Creating test refunds...');

  // Full refund for payment4
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const _refund1 = await prisma.refund.create({
    data: {
      paymentId: payment4.id,
      amount: new Decimal(211.99),
      currency: 'USD',
      provider: PaymentProvider.STRIPE,
      refundId: 're_test_full_refund_1',
      reason: RefundReason.CUSTOMER_REQUEST,
      status: RefundStatus.SUCCEEDED,
      notes: 'Customer changed mind - full refund issued',
      processedBy: 'admin-user-id',
      processedAt: new Date('2025-10-08T14:00:00Z'),
      completedAt: new Date('2025-10-08T14:05:00Z')
    }
  });

  // Partial refund for payment5
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const _refund2 = await prisma.refund.create({
    data: {
      paymentId: payment5.id,
      amount: new Decimal(149.99),
      currency: 'USD',
      provider: PaymentProvider.STRIPE,
      refundId: 're_test_partial_refund_1',
      reason: RefundReason.OTHER,
      status: RefundStatus.SUCCEEDED,
      notes: 'Refunded one item from order - customer kept the rest',
      processedBy: 'admin-user-id',
      processedAt: new Date('2025-10-10T10:30:00Z'),
      completedAt: new Date('2025-10-10T10:35:00Z')
    }
  });

  // Pending refund (for testing pending state)
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const _refund3 = await prisma.refund.create({
    data: {
      paymentId: payment1.id,
      amount: new Decimal(50.00),
      currency: 'USD',
      provider: PaymentProvider.STRIPE,
      refundId: 're_test_pending_refund',
      reason: RefundReason.DUPLICATE,
      status: RefundStatus.PENDING,
      notes: 'Pending refund - duplicate charge detected',
      processedBy: 'admin-user-id',
      processedAt: new Date('2025-10-12T08:00:00Z')
    }
  });

  console.log(`âœ… Created 3 test refunds\n`);

  // ========================================
  // 5. Create Test Webhook Logs
  // ========================================
  console.log('ðŸ“¡ Creating test webhook logs...');

  await prisma.webhookLog.create({
    data: {
      provider: PaymentProvider.STRIPE,
      eventType: 'payment_intent.succeeded',
      eventId: 'evt_test_success_1',
      payload: {
        id: 'evt_test_success_1',
        type: 'payment_intent.succeeded',
        data: {
          object: {
            id: payment1.transactionId,
            amount: 31499,
            currency: 'usd',
            status: 'succeeded'
          }
        }
      },
      signature: 't=1728000000,v1=test_signature_hash_123',
      verified: true,
      processed: true,
      processedAt: new Date('2025-10-10T14:30:05Z')
    }
  });

  await prisma.webhookLog.create({
    data: {
      provider: PaymentProvider.STRIPE,
      eventType: 'payment_intent.payment_failed',
      eventId: 'evt_test_failed_1',
      payload: {
        id: 'evt_test_failed_1',
        type: 'payment_intent.payment_failed',
        data: {
          object: {
            id: payment3.transactionId,
            amount: 62499,
            currency: 'usd',
            status: 'failed',
            last_payment_error: {
              message: 'Your card was declined.'
            }
          }
        }
      },
      signature: 't=1728100000,v1=test_signature_hash_456',
      verified: true,
      processed: true,
      processedAt: new Date('2025-10-11T09:20:05Z')
    }
  });

  await prisma.webhookLog.create({
    data: {
      provider: PaymentProvider.STRIPE,
      eventType: 'charge.refunded',
      eventId: 'evt_test_refund_1',
      payload: {
        id: 'evt_test_refund_1',
        type: 'charge.refunded',
        data: {
          object: {
            id: 'ch_test_123',
            payment_intent: payment4.transactionId,
            amount: 21199,
            amount_refunded: 21199,
            refunded: true
          }
        }
      },
      signature: 't=1728200000,v1=test_signature_hash_789',
      verified: true,
      processed: true,
      processedAt: new Date('2025-10-08T14:05:10Z')
    }
  });

  // Unprocessed webhook (for testing error handling)
  await prisma.webhookLog.create({
    data: {
      provider: PaymentProvider.STRIPE,
      eventType: 'payment_intent.created',
      eventId: 'evt_test_unprocessed',
      payload: {
        id: 'evt_test_unprocessed',
        type: 'payment_intent.created',
        data: {
          object: {
            id: 'pi_test_new',
            amount: 10000,
            currency: 'usd'
          }
        }
      },
      signature: 't=1728300000,v1=test_signature_hash_101',
      verified: true,
      processed: false
    }
  });

  console.log(`âœ… Created 4 test webhook logs\n`);

  // ========================================
  // Summary
  // ========================================
  console.log('âœ¨ Payment test data seeding complete!\n');
  console.log('ðŸ“Š Summary:');
  console.log('  - 3 test customers');
  console.log('  - 5 test orders (PAID, PENDING, PAYMENT_FAILED, REFUNDED)');
  console.log('  - 6 test payments (SUCCEEDED, PENDING, FAILED, REFUNDED, PARTIALLY_REFUNDED)');
  console.log('  - 3 test refunds (2 SUCCEEDED, 1 PENDING)');
  console.log('  - 4 test webhook logs (3 processed, 1 unprocessed)');
  console.log('\nðŸ”— Access payment admin:');
  console.log('  http://localhost:3000/admin/payments');
  console.log('\nâœ… Ready for UI testing!\n');
}

main()
  .catch((e) => {
    console.error('âŒ Error seeding payment test data:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
